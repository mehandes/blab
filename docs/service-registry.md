## Цель

Простой способ управления большим количеством различных сервисов. Контроль над используемыми ресурсами. Снижение временного и нервного напряжения при эксплуатации чужих сервисов для создания собственных.

## Решение

В целевой системе выделяется три основных модуля: хранилище, данные и сервисы. Работа с **каждым** из выделенных модулей на достаточном уровне абстракции позволит отложить некоторое количество решений и сделать систему расширяемой во всех направлениях.

### Данные

Данные абстрагируются с помощью единого структурированного формата, способного к конвертации в большинство популярных форматов для хранения данных и к эффективной сериализации в бинарное представление. Было решено использовать формат **Apache Avro**.

### Хранилище

Требования к хранилищу данных конкретные: масштабируемость, отказоустойчивость, возможность работы в режиме издатель-подписчик, возможность хранения потоковых данных за длительных промежуток времени без потери производительности, поддержка аутентификации. Единственная проверенная система отвечающая перечисленным критериям - **Apache Kafka**.

Несмотря на выбор конкретной реализации уже на этапе планирования, мы не ограничиваем себя данной технологией: при появлении более удачного решения и надобности в нем, абстракция данных, приведенная ранее, позволит произвести замену максимально безболезненно.

### Сервисы

**Сервис** - программа, получающая данные извне или генерирующая собственные, имеющая не менее одного выходного канала, а также до одного входного канала.

**Канал** - источник данных с фикированным форматом.

#digram
![diagram](https://github.com/mehandes/blab/blob/main/docs/sr.png)

Каждая сущность, по сути, является таблицей в базе данных (с некоторыми изменениями).

# Ключ доступа

Ключ доступа создан для ограничения прав доступа к каналам, определенным в конкретном сервисе. Запись в такие каналы возможна только при наличии соотвествующего ключа. Ключи доступа видны только администратору, который, соответсвенно, может распределять из между разработчиками.

# Сценарии использования

## Регистрация сервиса

Как видно из [диаграммы](#digram), для создания нового сервиса необходимо определить схему для каждого выходного канала и для канала конфигурации (если такой есть).

1. **Создание соотвествующих схем или выбор имеющихся**
	Схемы существуют независимо от каналов и сервисов, что позволяет управлять ими отдельно и использовать одну схему для определения нескольких каналов.
	
2. **Регистрация каналов**
	На данном этапе происходит привязка потока (topic) к определенной схеме. В случае, если поток уже привязан к схеме, операция звершится **ошибкой**. В таком случае, возможно [изменение существующего канала](#-Изменение-/-Удаление-канала).
	
3. **Регистрация сервиса**
	Завершающий этап. Происходит распределение каналов (какие выходные, а какой для конфигурации) и генерация [ключа доступа](#-Ключ-доступа). Каждому сервису присваивается уникальное имя, по которому возможен дальнейший поиск.

## Изменение / Удаление схемы

Изменение схемы сопровождается предупреждением о возможном нанесении ущерба использующим ее каналам (отображаются все каналы, которые ссылаются на данную схему). 

Удаление схемы возможно только при отсутствии ссылающихся на нее каналов.

## Изменение / Удаление канала

Изменение канала сопровождается предупреждением о возможном нанесении ущерба использующим его сервисам (отображаются все сервисы, которые ссылаются на данный канал). 

Удаление канала возможно только при отсутствии ссылающихся на него сервисов.

